<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">










  <meta name="google-site-verification" content="9MjjjAfbFmUf6_Qyjtd54x0imSx4ZtB_BRes0m0A_FM">















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.0',
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="åœ¨ macOX Sierra é€é brew æŒ‡ä»¤å®‰è£ php71ï¼ˆå¸¶æœ‰ php-fpmï¼‰åŠ nginxã€‚Install NGINX with PHP71 on Mac OS Sierra with Homebrew.">
<meta name="keywords" content="nginx,php71,php-fpm">
<meta property="og:type" content="article">
<meta property="og:title" content="Homebrew å®‰è£ Nginxã€PHP71 ç­†è¨˜">
<meta property="og:url" content="http://codefun.tw/2017/2017082701-brew-install-nginx-php71-fpm.html">
<meta property="og:site_name" content="Codefun">
<meta property="og:description" content="åœ¨ macOX Sierra é€é brew æŒ‡ä»¤å®‰è£ php71ï¼ˆå¸¶æœ‰ php-fpmï¼‰åŠ nginxã€‚Install NGINX with PHP71 on Mac OS Sierra with Homebrew.">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-08-27T10:08:52.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Homebrew å®‰è£ Nginxã€PHP71 ç­†è¨˜">
<meta name="twitter:description" content="åœ¨ macOX Sierra é€é brew æŒ‡ä»¤å®‰è£ php71ï¼ˆå¸¶æœ‰ php-fpmï¼‰åŠ nginxã€‚Install NGINX with PHP71 on Mac OS Sierra with Homebrew.">



  <link rel="alternate" href="/atom.xml" title="Codefun" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://codefun.tw/2017/2017082701-brew-install-nginx-php71-fpm">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Homebrew å®‰è£ Nginxã€PHP71 ç­†è¨˜ | Codefun</title>
  
  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId  : '',
        xfbml  : true,
        version: 'v2.10'
      });
    };
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {return;}
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>





  <script async src="//www.googletagmanager.com/gtag/js?id=UA-85444701-2"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-85444701-2');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Codefun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://codefun.tw/2017/2017082701-brew-install-nginx-php71-fpm.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jerry Huang">
      <meta itemprop="description" content="çŸ¥è­˜ä¸æ˜¯åŠ›é‡ åˆ†äº«çŸ¥è­˜æ‰æ˜¯åŠ›é‡">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codefun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Homebrew å®‰è£ Nginxã€PHP71 ç­†è¨˜

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-08-27 18:08:52" itemprop="dateCreated datePublished" datetime="2017-08-27T18:08:52+08:00">2017-08-27</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/lemp/" itemprop="url" rel="index"><span itemprop="name">lemp</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2017/2017082701-brew-install-nginx-php71-fpm.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://codefun.tw/2017/2017082701-brew-install-nginx-php71-fpm.html" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>åœ¨ macOX Sierra é€é <code>brew</code> æŒ‡ä»¤å®‰è£ <code>php71</code>ï¼ˆå¸¶æœ‰ <code>php-fpm</code>ï¼‰åŠ <code>nginx</code>ã€‚<br>Install NGINX with PHP71 on Mac OS Sierra with Homebrew.</p>
<a id="more"></a>
<h2 id="å‰è¨€-Prologue"><a href="#å‰è¨€-Prologue" class="headerlink" title="å‰è¨€  Prologue"></a>å‰è¨€  Prologue</h2><p>è‡¨æ™‚æœ‰éœ€è¦è®“ localhost é€éä½¿ç”¨ <a href="https://ngrok.com/" target="_blank" rel="noopener">ngrok</a> çš„å°å¤–æœå‹™ï¼Œä»¥æ¸¬è©¦ webhook åŠŸèƒ½ï¼ŒBUT nginx å°±åœ¨é€™å€‹æ™‚å€™å‡ºå•é¡Œäº†ã€‚<br>æœ¬ä¾†ä»¥ç‚ºæ˜¯ç”¨äº† <a href="https://laravel.com/docs/master/valet" target="_blank" rel="noopener">Laravel Valet</a> çš„é—œä¿‚ï¼Œä½†å³ä½¿æ˜¯åœç”¨ Valetï¼Œä¿®æ”¹ hosts æˆ–é‡å»º nginx.conf éƒ½æ–¼äº‹ç„¡è£œï¼Œåªå¥½å¾å®‰è£ PHP åˆ° Nginx é‡æ–°åšèµ·ã€‚</p>
<h2 id="ç’°å¢ƒ-Environment"><a href="#ç’°å¢ƒ-Environment" class="headerlink" title="ç’°å¢ƒ  Environment"></a>ç’°å¢ƒ  Environment</h2><ul>
<li>macOS Sierraï¼š 10.12.5</li>
<li>homebrewï¼š 1.3.1</li>
</ul>
<h2 id="Install-Commandline-Tools"><a href="#Install-Commandline-Tools" class="headerlink" title="Install Commandline Tools"></a>Install Commandline Tools</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ xcode-select â€”install</span><br></pre></td></tr></table></figure>
<h2 id="Install-Homebrew"><a href="#Install-Homebrew" class="headerlink" title="Install Homebrew"></a>Install Homebrew</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure>
<h3 id="Check-Installation"><a href="#Check-Installation" class="headerlink" title="Check Installation"></a>Check Installation</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew doctor</span><br></pre></td></tr></table></figure>
<h3 id="Update-Brew-and-Packages"><a href="#Update-Brew-and-Packages" class="headerlink" title="Update Brew and Packages"></a>Update Brew and Packages</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew update &amp;&amp; brew upgrade</span><br></pre></td></tr></table></figure>
<h3 id="Install-brew-services"><a href="#Install-brew-services" class="headerlink" title="Install brew services"></a>Install brew services</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap homebrew/services</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£-DNSMasq"><a href="#å®‰è£-DNSMasq" class="headerlink" title="å®‰è£ DNSMasq"></a>å®‰è£ DNSMasq</h2><p>DNSMasq is used to resolve all domains that end with .dev to 127.0.0.1.<br>DNSMasq å°‡ .env çµå°¾çš„ç¶²å€å°æ‡‰åˆ° 127.0.0.1ï¼Œå°±ä¸éœ€è¦å†ä¿®æ”¹ <code>/etc/hosts</code> æª”æ¡ˆ</p>
<h3 id="å®‰è£-Install"><a href="#å®‰è£-Install" class="headerlink" title="å®‰è£  Install"></a>å®‰è£  Install</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install dnsmasq</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®-Configure"><a href="#é…ç½®-Configure" class="headerlink" title="é…ç½®  Configure"></a>é…ç½®  Configure</h3><p>æª”æ¡ˆ <code>/usr/local/etc/dnsmasq.conf</code> å…§å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">address=/.dev/127.0.0.1</span><br><span class="line">listen-address=127.0.0.1</span><br></pre></td></tr></table></figure></p>
<p>æª”æ¡ˆ <code>/etc/resolver/dev</code> å…§å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameserver 127.0.0.1</span><br></pre></td></tr></table></figure></p>
<h3 id="startã€stopã€restart-DNSMasq"><a href="#startã€stopã€restart-DNSMasq" class="headerlink" title="startã€stopã€restart DNSMasq"></a><code>start</code>ã€<code>stop</code>ã€<code>restart</code> DNSMasq</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brew services start dnsmasq</span><br><span class="line">$ sudo brew services stop dnsmasq</span><br><span class="line">$ sudo brew services restart dnsmasq</span><br></pre></td></tr></table></figure>
<h3 id="æ¸¬è©¦-Testing"><a href="#æ¸¬è©¦-Testing" class="headerlink" title="æ¸¬è©¦  Testing"></a>æ¸¬è©¦  Testing</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ dig testing.dev @127.0.0.1</span><br><span class="line">dig testing.dev @127.0.0.1</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; testing.dev @127.0.0.1</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 21966</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;testing.dev.           IN  A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">testing.dev.        0   IN  A   127.0.0.1</span><br><span class="line"></span><br><span class="line">;; Query time: 1 msec</span><br><span class="line">;; SERVER: 127.0.0.1#53(127.0.0.1)</span><br><span class="line">;; WHEN: Sun Aug 27 22:39:50 2017</span><br><span class="line">;; MSG SIZE  rcvd: 45</span><br></pre></td></tr></table></figure>
<h2 id="å®‰è£-PHP-FPM"><a href="#å®‰è£-PHP-FPM" class="headerlink" title="å®‰è£ PHP-FPM"></a>å®‰è£ PHP-FPM</h2><h3 id="Install-php71"><a href="#Install-php71" class="headerlink" title="Install php71"></a>Install php71</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap homebrew/dupes &amp;&amp; \</span><br><span class="line">$ brew tap homebrew/php</span><br><span class="line"></span><br><span class="line">$ brew install php71</span><br><span class="line">==&gt; Installing php71 from homebrew/php</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles-php/php71-7.1.1_12.sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring php71-7.1.1_12.sierra.bottle.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">The php.ini file can be found in:</span><br><span class="line">    /usr/local/etc/php/7.1/php.ini</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© Extensions âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">If you are having issues with custom extension compiling, ensure that</span><br><span class="line">you are using the brew version, by placing /usr/local/bin before /usr/sbin in your PATH:</span><br><span class="line"></span><br><span class="line">      PATH=&quot;/usr/local/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">PHP71 Extensions will always be compiled against this PHP. Please install them</span><br><span class="line">using --without-homebrew-php to enable compiling against system PHP.</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© PHP CLI âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">If you wish to swap the PHP you use on the command line, you should add the following to ~/.bashrc,</span><br><span class="line">~/.zshrc, ~/.profile or your shell&apos;s equivalent configuration file:</span><br><span class="line"></span><br><span class="line">      export PATH=&quot;$(brew --prefix homebrew/php/php71)/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© FPM âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">To launch php-fpm on startup:</span><br><span class="line">    mkdir -p ~/Library/LaunchAgents</span><br><span class="line">    cp /usr/local/opt/php71/homebrew.mxcl.php71.plist ~/Library/LaunchAgents/</span><br><span class="line">    launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php71.plist</span><br><span class="line"></span><br><span class="line">The control script is located at /usr/local/opt/php71/sbin/php71-fpm</span><br><span class="line"></span><br><span class="line">OS X 10.8 and newer come with php-fpm pre-installed, to ensure you are using the brew version you need to make sure /usr/local/sbin is before /usr/sbin in your PATH:</span><br><span class="line"></span><br><span class="line">  PATH=&quot;/usr/local/sbin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">You may also need to edit the plist to use the correct &quot;UserName&quot;.</span><br><span class="line"></span><br><span class="line">Please note that the plist was called &apos;homebrew-php.josegonzalez.php71.plist&apos; in old versions</span><br><span class="line">of this formula.</span><br><span class="line"></span><br><span class="line">With the release of macOS Sierra the Apache module is now not built by default. If you want to build it on your system</span><br><span class="line">you have to install php with the --with-httpd24 option. See  brew options php71  for more details.</span><br><span class="line"></span><br><span class="line">To have launchd start homebrew/php/php71 now and restart at login:</span><br><span class="line">  brew services start homebrew/php/php71</span><br><span class="line">==&gt; Summary</span><br><span class="line">ğŸº  /usr/local/Cellar/php71/7.1.1_12: 344 files, 39.7M</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®-Configure-1"><a href="#é…ç½®-Configure-1" class="headerlink" title="é…ç½®  Configure"></a>é…ç½®  Configure</h3><p>ç·¨è¼¯æª”æ¡ˆ <code>/usr/local/etc/php/7.1/php-fpm.d/www.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user = YOUR_USERNAME</span><br><span class="line">group = staff</span><br></pre></td></tr></table></figure></p>
<h3 id="æ¸¬è©¦-Testing-1"><a href="#æ¸¬è©¦-Testing-1" class="headerlink" title="æ¸¬è©¦  Testing"></a>æ¸¬è©¦  Testing</h3><p>å•Ÿå‹• php-fpm<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brew services start php71</span><br></pre></td></tr></table></figure></p>
<p>Show running processes<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -Pni4 | grep LISTEN | grep php</span><br></pre></td></tr></table></figure></p>
<h2 id="å®‰è£-NGINX"><a href="#å®‰è£-NGINX" class="headerlink" title="å®‰è£ NGINX"></a>å®‰è£ NGINX</h2><h3 id="Install-NGINX"><a href="#Install-NGINX" class="headerlink" title="Install NGINX"></a>Install NGINX</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap homebrew/nginx</span><br><span class="line"></span><br><span class="line">$ brew install nginx</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/nginx-1.12.1.sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring nginx-1.12.1.sierra.bottle.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Docroot is: /usr/local/var/www</span><br><span class="line"></span><br><span class="line">The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that</span><br><span class="line">nginx can run without sudo.</span><br><span class="line"></span><br><span class="line">nginx will load all files in /usr/local/etc/nginx/servers/.</span><br><span class="line"></span><br><span class="line">To have launchd start nginx now and restart at login:</span><br><span class="line">  brew services start nginx</span><br><span class="line">Or, if you don&apos;t want/need a background service you can just run:</span><br><span class="line">  nginx</span><br><span class="line">==&gt; Summary</span><br><span class="line">ğŸº  /usr/local/Cellar/nginx/1.12.1: 23 files, 1MB</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£æ¸¬è©¦-Testing"><a href="#å®‰è£æ¸¬è©¦-Testing" class="headerlink" title="å®‰è£æ¸¬è©¦  Testing"></a>å®‰è£æ¸¬è©¦  Testing</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## Start Nginx</span><br><span class="line">$ sudo brew services start nginx</span><br><span class="line"></span><br><span class="line">## Check if Nginx is running on default port</span><br><span class="line">$ curl -IL http://127.0.0.1:8080</span><br><span class="line">curl -IL http://127.0.0.1:8080</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.12.1</span><br><span class="line">Date: Sun, 27 Aug 2017 14:59:30 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 274</span><br><span class="line">Last-Modified: Sat, 26 Aug 2017 14:05:36 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">ETag: &quot;59a18030-112&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>
<h3 id="Stop-Nginx"><a href="#Stop-Nginx" class="headerlink" title="Stop Nginx"></a>Stop Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brew services stop nginx</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®-Configure-2"><a href="#é…ç½®-Configure-2" class="headerlink" title="é…ç½®  Configure"></a>é…ç½®  Configure</h3><h4 id="å»ºç«‹ç›®éŒ„-Create-directories"><a href="#å»ºç«‹ç›®éŒ„-Create-directories" class="headerlink" title="å»ºç«‹ç›®éŒ„  Create directories"></a>å»ºç«‹ç›®éŒ„  Create directories</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /usr/local/etc/nginx/sites-available &amp;&amp; \</span><br><span class="line">$ mkdir -p /usr/local/etc/nginx/sites-enabled &amp;&amp; \</span><br><span class="line">$ mkdir -p /usr/local/etc/nginx/conf.d &amp;&amp; \</span><br><span class="line">$ mkdir -p /usr/local/etc/nginx/ssl</span><br></pre></td></tr></table></figure>
<h4 id="é…ç½®æª”æ¡ˆ-nginx-conf"><a href="#é…ç½®æª”æ¡ˆ-nginx-conf" class="headerlink" title="é…ç½®æª”æ¡ˆ nginx.conf"></a>é…ç½®æª”æ¡ˆ nginx.conf</h4><p>åˆªé™¤é è¨­æª”æ¡ˆ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rm /usr/local/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure></p>
<p>å»ºç«‹æ–°æª” <code>$ vim /usr/local/etc/nginx/nginx.conf</code> å…§å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include             mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    #sendfile            on;</span><br><span class="line">    sendfile            off;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout   65;</span><br><span class="line">    keepalive_timeout   1;</span><br><span class="line"></span><br><span class="line">    index index.html index.php;</span><br><span class="line"></span><br><span class="line">    include /usr/local/etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="å•Ÿå‹•ä¸¦æ¸¬è©¦-Nginx-Start-and-Test-Nginx"><a href="#å•Ÿå‹•ä¸¦æ¸¬è©¦-Nginx-Start-and-Test-Nginx" class="headerlink" title="å•Ÿå‹•ä¸¦æ¸¬è©¦ Nginx  Start and Test Nginx"></a>å•Ÿå‹•ä¸¦æ¸¬è©¦ Nginx  Start and Test Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## Start Nginx</span><br><span class="line">$ sudo brew services start nginx</span><br><span class="line"></span><br><span class="line">## Check if Nginx is running on default port</span><br><span class="line">$ curl -IL http://localhost</span><br><span class="line">curl -IL http://localhost</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.12.1</span><br><span class="line">Date: Sun, 27 Aug 2017 15:12:35 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 274</span><br><span class="line">Last-Modified: Sat, 26 Aug 2017 14:05:36 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">ETag: &quot;59a18030-112&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>
<h2 id="è¨­å®š-SSL-Setup-SSL"><a href="#è¨­å®š-SSL-Setup-SSL" class="headerlink" title="è¨­å®š SSL  Setup SSL"></a>è¨­å®š SSL  Setup SSL</h2><p>Generate 4096 bit RSA keys and the self-sign the certificates<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl req -new -newkey rsa:4096 -days 365 -nodes -x509 -subj &quot;/C=US/ST=State/L=Town/O=Office/CN=localhost&quot; -keyout /usr/local/etc/nginx/ssl/localhost.key -out /usr/local/etc/nginx/ssl/localhost.crt</span><br></pre></td></tr></table></figure></p>
<p>RSA keys å­˜æ”¾åœ¨è³‡æ–™å¤¾ <code>/usr/local/etc/nginx/ssl</code></p>
<h2 id="å»ºç«‹-Virtual-Hosts-ç¶²ç«™æª”æ¡ˆ"><a href="#å»ºç«‹-Virtual-Hosts-ç¶²ç«™æª”æ¡ˆ" class="headerlink" title="å»ºç«‹ Virtual Hosts ç¶²ç«™æª”æ¡ˆ"></a>å»ºç«‹ Virtual Hosts ç¶²ç«™æª”æ¡ˆ</h2><p>æª”æ¡ˆ <code>/usr/local/etc/nginx/sites-available/default</code> å…§å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root       /YOUR/DOCUMENT/ROOT;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/default.access.log  main;</span><br><span class="line">    error_log  /var/log/nginx/default.error.log  debug;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        include   /usr/local/etc/nginx/conf.d/php-fpm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /info &#123;</span><br><span class="line">        allow   127.0.0.1;</span><br><span class="line">        deny    all;</span><br><span class="line">        rewrite (.*) /.info.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page  404     /404.html;</span><br><span class="line">    error_page  403     /403.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æª”æ¡ˆ <code>/usr/local/etc/nginx/sites-available/default-ssl</code> å…§å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root       /YOUR/DOCUMENT/ROOT;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/default-ssl.access.log  main;</span><br><span class="line">    error_log  /var/log/nginx/default-ssl.error.log  debug;</span><br><span class="line"></span><br><span class="line">    ssl                  on;</span><br><span class="line">    ssl_certificate      ssl/localhost.crt;</span><br><span class="line">    ssl_certificate_key  ssl/localhost.key;</span><br><span class="line"></span><br><span class="line">    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    ssl_protocols  SSLv2 SSLv3 TLSv1;</span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    ssl_prefer_server_ciphers   on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        include   /usr/local/etc/nginx/conf.d/php-fpm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /info &#123;</span><br><span class="line">        allow   127.0.0.1;</span><br><span class="line">        deny    all;</span><br><span class="line">        rewrite (.*) /.info.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page  404     /404.html;</span><br><span class="line">    error_page  403     /403.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æª”æ¡ˆ <code>/usr/local/etc/nginx/conf.d/php-fpm</code> å…§å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    try_files      $uri = 404;</span><br><span class="line">    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">    include        fastcgi_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Activate-Virtual-Hosts"><a href="#Activate-Virtual-Hosts" class="headerlink" title="Activate Virtual Hosts"></a>Activate Virtual Hosts</h3><p>åœ¨ <code>sites-enabled</code> ç›®éŒ„ä¸‹å»ºç«‹ Symbolic linkã€‚å°‡è¦ enable çš„ virtal host æŒ‡å‘ <code>sites-available</code> ç›®éŒ„å…§çš„ virtal host config fileã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ln -sfv /usr/local/etc/nginx/sites-available/default /usr/local/etc/nginx/sites-enabled/default</span><br><span class="line">$ ln -sfv /usr/local/etc/nginx/sites-available/default-ssl /usr/local/etc/nginx/sites-enabled/default-ssl</span><br></pre></td></tr></table></figure></p>
<h3 id="æ¸¬è©¦-Testing-2"><a href="#æ¸¬è©¦-Testing-2" class="headerlink" title="æ¸¬è©¦ Testing"></a>æ¸¬è©¦ Testing</h3><p>å»ºç«‹ <code>/YOUR/DOCUMENT/ROOT/info.php</code> å…§å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>é‡æ–°å•Ÿå‹• Nginx ä¸¦æ¸¬è©¦<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brew services restart nginx</span><br><span class="line"></span><br><span class="line">$ curl -IL http://localhost/info.php</span><br><span class="line">curl -IL http://localhost/info.php</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.12.1</span><br><span class="line">Date: Sun, 27 Aug 2017 15:24:46 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Connection: keep-alive</span><br><span class="line">X-Powered-By: PHP/7.1.8</span><br></pre></td></tr></table></figure></p>
<h2 id="å®‰è£å…¶ä»–-Libraries"><a href="#å®‰è£å…¶ä»–-Libraries" class="headerlink" title="å®‰è£å…¶ä»– Libraries"></a>å®‰è£å…¶ä»– Libraries</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install php71-mcrypt php71-imagick</span><br></pre></td></tr></table></figure>
<p><code>brew info</code> æŸ¥çœ‹ PHP åŠå…¶ç›¸é—œ Libraries çš„è³‡è¨Š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">$ brew info php71</span><br><span class="line">homebrew/php/php71: stable 7.1.8 (bottled), HEAD</span><br><span class="line">PHP Version 7.1</span><br><span class="line">https://php.net</span><br><span class="line">Conflicts with:</span><br><span class="line">  php53 (because different php versions install the same binaries.)</span><br><span class="line">  php54 (because different php versions install the same binaries.)</span><br><span class="line">  php55 (because different php versions install the same binaries.)</span><br><span class="line">  php56 (because different php versions install the same binaries.)</span><br><span class="line">  php70 (because different php versions install the same binaries.)</span><br><span class="line">  php72 (because different php versions install the same binaries.)</span><br><span class="line">/usr/local/Cellar/php71/7.1.8_20 (349 files, 39.5MB) *</span><br><span class="line">  Poured from bottle on 2017-08-26 at 16:34:27</span><br><span class="line">From: https://github.com/Homebrew/homebrew-php/blob/master/Formula/php71.rb</span><br><span class="line">==&gt; Dependencies</span><br><span class="line">Required: freetype âœ”, gettext âœ”, icu4c âœ”, jpeg âœ”, libpng âœ”, libxml2 âœ”, unixodbc âœ”, readline âœ”, openssl âœ”</span><br><span class="line">Optional: enchant âœ˜, gmp âœ˜, webp âœ˜, homebrew/apache/httpd24 âœ”, homebrew/apache/httpd22 âœ˜</span><br><span class="line">==&gt; Requirements</span><br><span class="line">Optional: postgresql âœ˜</span><br><span class="line">==&gt; Options</span><br><span class="line">--with-cgi</span><br><span class="line">	Enable building of the CGI executable (implies --without-fpm)</span><br><span class="line">--with-debug</span><br><span class="line">	Compile with debugging symbols</span><br><span class="line">--with-enchant</span><br><span class="line">	Build with enchant support</span><br><span class="line">--with-gmp</span><br><span class="line">	Build with gmp support</span><br><span class="line">--with-homebrew-curl</span><br><span class="line">	Include Curl support via Homebrew</span><br><span class="line">--with-homebrew-libressl</span><br><span class="line">	Include LibreSSL instead of OpenSSL via Homebrew</span><br><span class="line">--with-homebrew-libxml2</span><br><span class="line">	Include Libxml2 support via Homebrew</span><br><span class="line">--with-homebrew-libxslt</span><br><span class="line">	Include LibXSLT support via Homebrew</span><br><span class="line">--with-httpd22</span><br><span class="line">	Enable building of shared Apache 2.2 Handler module</span><br><span class="line">--with-httpd24</span><br><span class="line">	Enable building of shared Apache 2.4 Handler module</span><br><span class="line">--with-imap</span><br><span class="line">	Include IMAP extension</span><br><span class="line">--with-libmysql</span><br><span class="line">	Include (old-style) libmysql support instead of mysqlnd</span><br><span class="line">--with-mssql</span><br><span class="line">	Include MSSQL-DB support</span><br><span class="line">--with-pdo-oci</span><br><span class="line">	Include Oracle databases (requries ORACLE_HOME be set)</span><br><span class="line">--with-pear</span><br><span class="line">	Build with PEAR</span><br><span class="line">--with-phpdbg</span><br><span class="line">	Enable building of the phpdbg SAPI executable</span><br><span class="line">--with-postgresql</span><br><span class="line">	Build with postgresql support</span><br><span class="line">--with-thread-safety</span><br><span class="line">	Build with thread safety</span><br><span class="line">--with-webp</span><br><span class="line">	Build with webp support</span><br><span class="line">--without-bz2</span><br><span class="line">	Build without bz2 support</span><br><span class="line">--without-fpm</span><br><span class="line">	Disable building of the fpm SAPI executable</span><br><span class="line">--without-ldap</span><br><span class="line">	Build without LDAP support</span><br><span class="line">--without-legacy-mysql</span><br><span class="line">	Do not include the deprecated mysql_ functions</span><br><span class="line">--without-mysql</span><br><span class="line">	Remove MySQL/MariaDB support</span><br><span class="line">--without-pcntl</span><br><span class="line">	Build without Process Control support</span><br><span class="line">--without-unixodbc</span><br><span class="line">	Build without unixODBC support</span><br><span class="line">--HEAD</span><br><span class="line">	Install HEAD version</span><br><span class="line">==&gt; Caveats</span><br><span class="line">The php.ini file can be found in:</span><br><span class="line">    /usr/local/etc/php/7.1/php.ini</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© Extensions âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">If you are having issues with custom extension compiling, ensure that you are using the brew version, by placing /usr/local/bin before /usr/sbin in your PATH:</span><br><span class="line"></span><br><span class="line">      PATH=&quot;/usr/local/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">PHP71 Extensions will always be compiled against this PHP. Please install them using --without-homebrew-php to enable compiling against system PHP.</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© PHP CLI âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">If you wish to swap the PHP you use on the command line, you should add the following to ~/.bashrc, ~/.zshrc, ~/.profile or your shell&apos;s equivalent configuration file:</span><br><span class="line">  export PATH=&quot;$(brew --prefix homebrew/php/php71)/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© FPM âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">To launch php-fpm on startup:</span><br><span class="line">    mkdir -p ~/Library/LaunchAgents</span><br><span class="line">    cp /usr/local/opt/php71/homebrew.mxcl.php71.plist ~/Library/LaunchAgents/</span><br><span class="line">    launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php71.plist</span><br><span class="line"></span><br><span class="line">The control script is located at /usr/local/opt/php71/sbin/php71-fpm</span><br><span class="line"></span><br><span class="line">OS X 10.8 and newer come with php-fpm pre-installed, to ensure you are using the brew version you need to make sure /usr/local/sbin is before /usr/sbin in your PATH:</span><br><span class="line"></span><br><span class="line">  PATH=&quot;/usr/local/sbin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">You may also need to edit the plist to use the correct &quot;UserName&quot;.</span><br><span class="line"></span><br><span class="line">Please note that the plist was called &apos;homebrew-php.josegonzalez.php71.plist&apos; in old versions of this formula.</span><br><span class="line"></span><br><span class="line">With the release of macOS Sierra the Apache module is now not built by default. If you want to build it on your system you have to install php with the --with-httpd24 option. See  brew options php71 for more details.</span><br><span class="line"></span><br><span class="line">To have launchd start homebrew/php/php71 now and restart at login:</span><br><span class="line">  brew services start homebrew/php/php71</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="å¾Œè¨˜-Epilogue"><a href="#å¾Œè¨˜-Epilogue" class="headerlink" title="å¾Œè¨˜ Epilogue"></a>å¾Œè¨˜ Epilogue</h2><p>å¦‚æœ <code>$ curl -IL http://127.0.0.1:8080</code> å‡ºç¾ <code>curl: (7) Failed to connect to 127.0.0.1 port 8080: Connection refused</code>ï¼Œè«‹è¨˜å¾—æª¢æŸ¥</p>
<ol>
<li>php-fpm æ˜¯ä¸æ˜¯å•Ÿå‹•</li>
<li>nginx æ˜¯å¦æœ‰ restart</li>
<li><code>/usr/loca/etc/php/7.1/php-fpm.d/www.conf</code> å…§ <code>user</code> åŠ <code>group</code> æ˜¯å¦æ­£ç¢ºè¨­å®š</li>
<li><code>/usr/local/etc/nginx/conf.d/php-fpm</code> æª”æ¡ˆæ˜¯å¦å»ºç«‹</li>
</ol>
<hr>
<h2 id="åƒè€ƒè³‡æ–™-References"><a href="#åƒè€ƒè³‡æ–™-References" class="headerlink" title="åƒè€ƒè³‡æ–™  References"></a>åƒè€ƒè³‡æ–™  References</h2><ul>
<li><a href="https://gist.github.com/dtomasi/ab76d14338db82ec24a1fc137caff75b" target="_blank" rel="noopener">Install NGINX with PHP7-FPM on Mac OS X with Homebrew</a></li>
<li><a href="https://gist.github.com/pixeline/51c43c787f51b018d484597f30be3d2b" target="_blank" rel="noopener">pixeline/php_upgrade_to_71.sh</a></li>
</ul>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/nginx/" rel="tag"># nginx</a>
          
            <a href="/tags/php71/" rel="tag"># php71</a>
          
            <a href="/tags/php-fpm/" rel="tag"># php-fpm</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/2017081804-wget-download-web-pages.html" rel="next" title="ä½¿ç”¨ wget ç ç«™">
                <i class="fa fa-chevron-left"></i> ä½¿ç”¨ wget ç ç«™
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/2017082901-editorconfig-settings.html" rel="prev" title="ä½¿ç”¨ EditorConfig çµ±ä¸€å°ˆæ¡ˆçš„ Coding Style">
                ä½¿ç”¨ EditorConfig çµ±ä¸€å°ˆæ¡ˆçš„ Coding Style <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div class="fb-comments" data-href="http://codefun.tw/2017/2017082701-brew-install-nginx-php71-fpm.html" data-numposts="10" data-width="100%" data-colorscheme="light">
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.png" alt="Jerry Huang">
            
              <p class="site-author-name" itemprop="name">Jerry Huang</p>
              <div class="site-description motion-element" itemprop="description">çŸ¥è­˜ä¸æ˜¯åŠ›é‡ åˆ†äº«çŸ¥è­˜æ‰æ˜¯åŠ›é‡</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">31</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.linkedin.com/in/jerry771230" title="LinkedIn &rarr; https://www.linkedin.com/in/jerry771230" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i>LinkedIn</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å‰è¨€-Prologue"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€  Prologue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç’°å¢ƒ-Environment"><span class="nav-number">2.</span> <span class="nav-text">ç’°å¢ƒ  Environment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-Commandline-Tools"><span class="nav-number">3.</span> <span class="nav-text">Install Commandline Tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-Homebrew"><span class="nav-number">4.</span> <span class="nav-text">Install Homebrew</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Check-Installation"><span class="nav-number">4.1.</span> <span class="nav-text">Check Installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update-Brew-and-Packages"><span class="nav-number">4.2.</span> <span class="nav-text">Update Brew and Packages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-brew-services"><span class="nav-number">4.3.</span> <span class="nav-text">Install brew services</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®‰è£-DNSMasq"><span class="nav-number">5.</span> <span class="nav-text">å®‰è£ DNSMasq</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£-Install"><span class="nav-number">5.1.</span> <span class="nav-text">å®‰è£  Install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é…ç½®-Configure"><span class="nav-number">5.2.</span> <span class="nav-text">é…ç½®  Configure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#startã€stopã€restart-DNSMasq"><span class="nav-number">5.3.</span> <span class="nav-text">startã€stopã€restart DNSMasq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¸¬è©¦-Testing"><span class="nav-number">5.4.</span> <span class="nav-text">æ¸¬è©¦  Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®‰è£-PHP-FPM"><span class="nav-number">6.</span> <span class="nav-text">å®‰è£ PHP-FPM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-php71"><span class="nav-number">6.1.</span> <span class="nav-text">Install php71</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é…ç½®-Configure-1"><span class="nav-number">6.2.</span> <span class="nav-text">é…ç½®  Configure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¸¬è©¦-Testing-1"><span class="nav-number">6.3.</span> <span class="nav-text">æ¸¬è©¦  Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®‰è£-NGINX"><span class="nav-number">7.</span> <span class="nav-text">å®‰è£ NGINX</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-NGINX"><span class="nav-number">7.1.</span> <span class="nav-text">Install NGINX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£æ¸¬è©¦-Testing"><span class="nav-number">7.2.</span> <span class="nav-text">å®‰è£æ¸¬è©¦  Testing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stop-Nginx"><span class="nav-number">7.3.</span> <span class="nav-text">Stop Nginx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é…ç½®-Configure-2"><span class="nav-number">7.4.</span> <span class="nav-text">é…ç½®  Configure</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å»ºç«‹ç›®éŒ„-Create-directories"><span class="nav-number">7.4.1.</span> <span class="nav-text">å»ºç«‹ç›®éŒ„  Create directories</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é…ç½®æª”æ¡ˆ-nginx-conf"><span class="nav-number">7.4.2.</span> <span class="nav-text">é…ç½®æª”æ¡ˆ nginx.conf</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å•Ÿå‹•ä¸¦æ¸¬è©¦-Nginx-Start-and-Test-Nginx"><span class="nav-number">7.5.</span> <span class="nav-text">å•Ÿå‹•ä¸¦æ¸¬è©¦ Nginx  Start and Test Nginx</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è¨­å®š-SSL-Setup-SSL"><span class="nav-number">8.</span> <span class="nav-text">è¨­å®š SSL  Setup SSL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å»ºç«‹-Virtual-Hosts-ç¶²ç«™æª”æ¡ˆ"><span class="nav-number">9.</span> <span class="nav-text">å»ºç«‹ Virtual Hosts ç¶²ç«™æª”æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Activate-Virtual-Hosts"><span class="nav-number">9.1.</span> <span class="nav-text">Activate Virtual Hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¸¬è©¦-Testing-2"><span class="nav-number">9.2.</span> <span class="nav-text">æ¸¬è©¦ Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®‰è£å…¶ä»–-Libraries"><span class="nav-number">10.</span> <span class="nav-text">å®‰è£å…¶ä»– Libraries</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¾Œè¨˜-Epilogue"><span class="nav-number">11.</span> <span class="nav-text">å¾Œè¨˜ Epilogue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åƒè€ƒè³‡æ–™-References"><span class="nav-number">12.</span> <span class="nav-text">åƒè€ƒè³‡æ–™  References</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 â€“ <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jerry Huang</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
      <div>
        <div class="addthis_inline_share_toolbox">
  <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-59202e2d25ce1195" async="async"></script>
</div>

      </div>
    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>




  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
