<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"codefun.tw","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.12.1","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="åœ¨ macOX Sierra é€é brew æŒ‡ä»¤å®‰è£ php71ï¼ˆå¸¶æœ‰ php-fpmï¼‰åŠ nginxã€‚Install NGINX with PHP71 on Mac OS Sierra with Homebrew.">
<meta property="og:type" content="article">
<meta property="og:title" content="Homebrew å®‰è£ Nginxã€PHP71 ç­†è¨˜">
<meta property="og:url" content="http://codefun.tw/2017/2017082701-brew-install-nginx-php71-fpm.html">
<meta property="og:site_name" content="Codefun">
<meta property="og:description" content="åœ¨ macOX Sierra é€é brew æŒ‡ä»¤å®‰è£ php71ï¼ˆå¸¶æœ‰ php-fpmï¼‰åŠ nginxã€‚Install NGINX with PHP71 on Mac OS Sierra with Homebrew.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-08-27T10:08:52.000Z">
<meta property="article:modified_time" content="2017-08-27T10:08:52.000Z">
<meta property="article:author" content="Jerry Huang">
<meta property="article:tag" content="nginx">
<meta property="article:tag" content="php71">
<meta property="article:tag" content="php-fpm">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://codefun.tw/2017/2017082701-brew-install-nginx-php71-fpm.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://codefun.tw/2017/2017082701-brew-install-nginx-php71-fpm.html","path":"2017/2017082701-brew-install-nginx-php71-fpm.html","title":"Homebrew å®‰è£ Nginxã€PHP71 ç­†è¨˜"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Homebrew å®‰è£ Nginxã€PHP71 ç­†è¨˜ | Codefun</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Codefun" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Codefun</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80-Prologue"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€  Prologue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%92%B0%E5%A2%83-Environment"><span class="nav-number">2.</span> <span class="nav-text">ç’°å¢ƒ  Environment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-Commandline-Tools"><span class="nav-number">3.</span> <span class="nav-text">Install Commandline Tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-Homebrew"><span class="nav-number">4.</span> <span class="nav-text">Install Homebrew</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Check-Installation"><span class="nav-number">4.1.</span> <span class="nav-text">Check Installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update-Brew-and-Packages"><span class="nav-number">4.2.</span> <span class="nav-text">Update Brew and Packages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-brew-services"><span class="nav-number">4.3.</span> <span class="nav-text">Install brew services</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%9D-DNSMasq"><span class="nav-number">5.</span> <span class="nav-text">å®‰è£ DNSMasq</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%9D-Install"><span class="nav-number">5.1.</span> <span class="nav-text">å®‰è£  Install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Configure"><span class="nav-number">5.2.</span> <span class="nav-text">é…ç½®  Configure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#start%E3%80%81stop%E3%80%81restart-DNSMasq"><span class="nav-number">5.3.</span> <span class="nav-text">startã€stopã€restart DNSMasq</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%AC%E8%A9%A6-Testing"><span class="nav-number">5.4.</span> <span class="nav-text">æ¸¬è©¦  Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%9D-PHP-FPM"><span class="nav-number">6.</span> <span class="nav-text">å®‰è£ PHP-FPM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-php71"><span class="nav-number">6.1.</span> <span class="nav-text">Install php71</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Configure-1"><span class="nav-number">6.2.</span> <span class="nav-text">é…ç½®  Configure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%AC%E8%A9%A6-Testing-1"><span class="nav-number">6.3.</span> <span class="nav-text">æ¸¬è©¦  Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%9D-NGINX"><span class="nav-number">7.</span> <span class="nav-text">å®‰è£ NGINX</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-NGINX"><span class="nav-number">7.1.</span> <span class="nav-text">Install NGINX</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%9D%E6%B8%AC%E8%A9%A6-Testing"><span class="nav-number">7.2.</span> <span class="nav-text">å®‰è£æ¸¬è©¦  Testing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stop-Nginx"><span class="nav-number">7.3.</span> <span class="nav-text">Stop Nginx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-Configure-2"><span class="nav-number">7.4.</span> <span class="nav-text">é…ç½®  Configure</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E7%9B%AE%E9%8C%84-Create-directories"><span class="nav-number">7.4.1.</span> <span class="nav-text">å»ºç«‹ç›®éŒ„  Create directories</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%AA%94%E6%A1%88-nginx-conf"><span class="nav-number">7.4.2.</span> <span class="nav-text">é…ç½®æª”æ¡ˆ nginx.conf</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%95%9F%E5%8B%95%E4%B8%A6%E6%B8%AC%E8%A9%A6-Nginx-Start-and-Test-Nginx"><span class="nav-number">7.5.</span> <span class="nav-text">å•Ÿå‹•ä¸¦æ¸¬è©¦ Nginx  Start and Test Nginx</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A8%AD%E5%AE%9A-SSL-Setup-SSL"><span class="nav-number">8.</span> <span class="nav-text">è¨­å®š SSL  Setup SSL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B-Virtual-Hosts-%E7%B6%B2%E7%AB%99%E6%AA%94%E6%A1%88"><span class="nav-number">9.</span> <span class="nav-text">å»ºç«‹ Virtual Hosts ç¶²ç«™æª”æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Activate-Virtual-Hosts"><span class="nav-number">9.1.</span> <span class="nav-text">Activate Virtual Hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%AC%E8%A9%A6-Testing-2"><span class="nav-number">9.2.</span> <span class="nav-text">æ¸¬è©¦ Testing</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%9D%E5%85%B6%E4%BB%96-Libraries"><span class="nav-number">10.</span> <span class="nav-text">å®‰è£å…¶ä»– Libraries</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%8C%E8%A8%98-Epilogue"><span class="nav-number">11.</span> <span class="nav-text">å¾Œè¨˜ Epilogue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99-References"><span class="nav-number">12.</span> <span class="nav-text">åƒè€ƒè³‡æ–™  References</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jerry Huang</p>
  <div class="site-description" itemprop="description">çŸ¥è­˜ä¸æ˜¯åŠ›é‡ åˆ†äº«çŸ¥è­˜æ‰æ˜¯åŠ›é‡</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/jerry771230" title="LinkedIn â†’ https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;jerry771230" rel="noopener" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://codefun.tw/2017/2017082701-brew-install-nginx-php71-fpm.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codefun">
      <meta itemprop="description" content="çŸ¥è­˜ä¸æ˜¯åŠ›é‡ åˆ†äº«çŸ¥è­˜æ‰æ˜¯åŠ›é‡">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Homebrew å®‰è£ Nginxã€PHP71 ç­†è¨˜ | Codefun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Homebrew å®‰è£ Nginxã€PHP71 ç­†è¨˜
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-08-27 18:08:52" itemprop="dateCreated datePublished" datetime="2017-08-27T18:08:52+08:00">2017-08-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/lemp/" itemprop="url" rel="index"><span itemprop="name">lemp</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span></span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>NaN:aN</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>åœ¨ macOX Sierra é€é <code>brew</code> æŒ‡ä»¤å®‰è£ <code>php71</code>ï¼ˆå¸¶æœ‰ <code>php-fpm</code>ï¼‰åŠ <code>nginx</code>ã€‚<br>Install NGINX with PHP71 on Mac OS Sierra with Homebrew.</p>
<span id="more"></span>

<h2 id="å‰è¨€-Prologue"><a href="#å‰è¨€-Prologue" class="headerlink" title="å‰è¨€  Prologue"></a>å‰è¨€  Prologue</h2><p>è‡¨æ™‚æœ‰éœ€è¦è®“ localhost é€éä½¿ç”¨ <a target="_blank" rel="noopener" href="https://ngrok.com/">ngrok</a> çš„å°å¤–æœå‹™ï¼Œä»¥æ¸¬è©¦ webhook åŠŸèƒ½ï¼ŒBUT nginx å°±åœ¨é€™å€‹æ™‚å€™å‡ºå•é¡Œäº†ã€‚<br>æœ¬ä¾†ä»¥ç‚ºæ˜¯ç”¨äº† <a target="_blank" rel="noopener" href="https://laravel.com/docs/master/valet">Laravel Valet</a> çš„é—œä¿‚ï¼Œä½†å³ä½¿æ˜¯åœç”¨ Valetï¼Œä¿®æ”¹ hosts æˆ–é‡å»º nginx.conf éƒ½æ–¼äº‹ç„¡è£œï¼Œåªå¥½å¾å®‰è£ PHP åˆ° Nginx é‡æ–°åšèµ·ã€‚</p>
<h2 id="ç’°å¢ƒ-Environment"><a href="#ç’°å¢ƒ-Environment" class="headerlink" title="ç’°å¢ƒ  Environment"></a>ç’°å¢ƒ  Environment</h2><ul>
<li>macOS Sierraï¼š 10.12.5</li>
<li>homebrewï¼š 1.3.1</li>
</ul>
<h2 id="Install-Commandline-Tools"><a href="#Install-Commandline-Tools" class="headerlink" title="Install Commandline Tools"></a>Install Commandline Tools</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ xcode-select â€”install</span><br></pre></td></tr></table></figure>

<h2 id="Install-Homebrew"><a href="#Install-Homebrew" class="headerlink" title="Install Homebrew"></a>Install Homebrew</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure>

<h3 id="Check-Installation"><a href="#Check-Installation" class="headerlink" title="Check Installation"></a>Check Installation</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew doctor</span><br></pre></td></tr></table></figure>

<h3 id="Update-Brew-and-Packages"><a href="#Update-Brew-and-Packages" class="headerlink" title="Update Brew and Packages"></a>Update Brew and Packages</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew update &amp;&amp; brew upgrade</span><br></pre></td></tr></table></figure>

<h3 id="Install-brew-services"><a href="#Install-brew-services" class="headerlink" title="Install brew services"></a>Install brew services</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap homebrew/services</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£-DNSMasq"><a href="#å®‰è£-DNSMasq" class="headerlink" title="å®‰è£ DNSMasq"></a>å®‰è£ DNSMasq</h2><p>DNSMasq is used to resolve all domains that end with .dev to 127.0.0.1.<br>DNSMasq å°‡ .env çµå°¾çš„ç¶²å€å°æ‡‰åˆ° 127.0.0.1ï¼Œå°±ä¸éœ€è¦å†ä¿®æ”¹ <code>/etc/hosts</code> æª”æ¡ˆ</p>
<h3 id="å®‰è£-Install"><a href="#å®‰è£-Install" class="headerlink" title="å®‰è£  Install"></a>å®‰è£  Install</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install dnsmasq</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®-Configure"><a href="#é…ç½®-Configure" class="headerlink" title="é…ç½®  Configure"></a>é…ç½®  Configure</h3><p>æª”æ¡ˆ <code>/usr/local/etc/dnsmasq.conf</code> å…§å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">address=/.dev/127.0.0.1</span><br><span class="line">listen-address=127.0.0.1</span><br></pre></td></tr></table></figure>

<p>æª”æ¡ˆ <code>/etc/resolver/dev</code> å…§å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nameserver 127.0.0.1</span><br></pre></td></tr></table></figure>

<h3 id="startã€stopã€restart-DNSMasq"><a href="#startã€stopã€restart-DNSMasq" class="headerlink" title="startã€stopã€restart DNSMasq"></a><code>start</code>ã€<code>stop</code>ã€<code>restart</code> DNSMasq</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brew services start dnsmasq</span><br><span class="line">$ sudo brew services stop dnsmasq</span><br><span class="line">$ sudo brew services restart dnsmasq</span><br></pre></td></tr></table></figure>

<h3 id="æ¸¬è©¦-Testing"><a href="#æ¸¬è©¦-Testing" class="headerlink" title="æ¸¬è©¦  Testing"></a>æ¸¬è©¦  Testing</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ dig testing.dev @127.0.0.1</span><br><span class="line">dig testing.dev @127.0.0.1</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; testing.dev @127.0.0.1</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 21966</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;testing.dev.           IN  A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">testing.dev.        0   IN  A   127.0.0.1</span><br><span class="line"></span><br><span class="line">;; Query time: 1 msec</span><br><span class="line">;; SERVER: 127.0.0.1#53(127.0.0.1)</span><br><span class="line">;; WHEN: Sun Aug 27 22:39:50 2017</span><br><span class="line">;; MSG SIZE  rcvd: 45</span><br></pre></td></tr></table></figure>



<h2 id="å®‰è£-PHP-FPM"><a href="#å®‰è£-PHP-FPM" class="headerlink" title="å®‰è£ PHP-FPM"></a>å®‰è£ PHP-FPM</h2><h3 id="Install-php71"><a href="#Install-php71" class="headerlink" title="Install php71"></a>Install php71</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap homebrew/dupes &amp;&amp; \</span><br><span class="line">$ brew tap homebrew/php</span><br><span class="line"></span><br><span class="line">$ brew install php71</span><br><span class="line">==&gt; Installing php71 from homebrew/php</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles-php/php71-7.1.1_12.sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring php71-7.1.1_12.sierra.bottle.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">The php.ini file can be found in:</span><br><span class="line">    /usr/local/etc/php/7.1/php.ini</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© Extensions âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">If you are having issues with custom extension compiling, ensure that</span><br><span class="line">you are using the brew version, by placing /usr/local/bin before /usr/sbin in your PATH:</span><br><span class="line"></span><br><span class="line">      PATH=&quot;/usr/local/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">PHP71 Extensions will always be compiled against this PHP. Please install them</span><br><span class="line">using --without-homebrew-php to enable compiling against system PHP.</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© PHP CLI âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">If you wish to swap the PHP you use on the command line, you should add the following to ~/.bashrc,</span><br><span class="line">~/.zshrc, ~/.profile or your shell&#x27;s equivalent configuration file:</span><br><span class="line"></span><br><span class="line">      export PATH=&quot;$(brew --prefix homebrew/php/php71)/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© FPM âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">To launch php-fpm on startup:</span><br><span class="line">    mkdir -p ~/Library/LaunchAgents</span><br><span class="line">    cp /usr/local/opt/php71/homebrew.mxcl.php71.plist ~/Library/LaunchAgents/</span><br><span class="line">    launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php71.plist</span><br><span class="line"></span><br><span class="line">The control script is located at /usr/local/opt/php71/sbin/php71-fpm</span><br><span class="line"></span><br><span class="line">OS X 10.8 and newer come with php-fpm pre-installed, to ensure you are using the brew version you need to make sure /usr/local/sbin is before /usr/sbin in your PATH:</span><br><span class="line"></span><br><span class="line">  PATH=&quot;/usr/local/sbin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">You may also need to edit the plist to use the correct &quot;UserName&quot;.</span><br><span class="line"></span><br><span class="line">Please note that the plist was called &#x27;homebrew-php.josegonzalez.php71.plist&#x27; in old versions</span><br><span class="line">of this formula.</span><br><span class="line"></span><br><span class="line">With the release of macOS Sierra the Apache module is now not built by default. If you want to build it on your system</span><br><span class="line">you have to install php with the --with-httpd24 option. See  brew options php71  for more details.</span><br><span class="line"></span><br><span class="line">To have launchd start homebrew/php/php71 now and restart at login:</span><br><span class="line">  brew services start homebrew/php/php71</span><br><span class="line">==&gt; Summary</span><br><span class="line">ğŸº  /usr/local/Cellar/php71/7.1.1_12: 344 files, 39.7M</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®-Configure-1"><a href="#é…ç½®-Configure-1" class="headerlink" title="é…ç½®  Configure"></a>é…ç½®  Configure</h3><p>ç·¨è¼¯æª”æ¡ˆ <code>/usr/local/etc/php/7.1/php-fpm.d/www.conf</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user = YOUR_USERNAME</span><br><span class="line">group = staff</span><br></pre></td></tr></table></figure>

<h3 id="æ¸¬è©¦-Testing-1"><a href="#æ¸¬è©¦-Testing-1" class="headerlink" title="æ¸¬è©¦  Testing"></a>æ¸¬è©¦  Testing</h3><p>å•Ÿå‹• php-fpm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brew services start php71</span><br></pre></td></tr></table></figure>

<p>Show running processes</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -Pni4 | grep LISTEN | grep php</span><br></pre></td></tr></table></figure>


<h2 id="å®‰è£-NGINX"><a href="#å®‰è£-NGINX" class="headerlink" title="å®‰è£ NGINX"></a>å®‰è£ NGINX</h2><h3 id="Install-NGINX"><a href="#Install-NGINX" class="headerlink" title="Install NGINX"></a>Install NGINX</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap homebrew/nginx</span><br><span class="line"></span><br><span class="line">$ brew install nginx</span><br><span class="line">==&gt; Downloading https://homebrew.bintray.com/bottles/nginx-1.12.1.sierra.bottle.tar.gz</span><br><span class="line">######################################################################## 100.0%</span><br><span class="line">==&gt; Pouring nginx-1.12.1.sierra.bottle.tar.gz</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Docroot is: /usr/local/var/www</span><br><span class="line"></span><br><span class="line">The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that</span><br><span class="line">nginx can run without sudo.</span><br><span class="line"></span><br><span class="line">nginx will load all files in /usr/local/etc/nginx/servers/.</span><br><span class="line"></span><br><span class="line">To have launchd start nginx now and restart at login:</span><br><span class="line">  brew services start nginx</span><br><span class="line">Or, if you don&#x27;t want/need a background service you can just run:</span><br><span class="line">  nginx</span><br><span class="line">==&gt; Summary</span><br><span class="line">ğŸº  /usr/local/Cellar/nginx/1.12.1: 23 files, 1MB</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£æ¸¬è©¦-Testing"><a href="#å®‰è£æ¸¬è©¦-Testing" class="headerlink" title="å®‰è£æ¸¬è©¦  Testing"></a>å®‰è£æ¸¬è©¦  Testing</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## Start Nginx</span><br><span class="line">$ sudo brew services start nginx</span><br><span class="line"></span><br><span class="line">## Check if Nginx is running on default port</span><br><span class="line">$ curl -IL http://127.0.0.1:8080</span><br><span class="line">curl -IL http://127.0.0.1:8080</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.12.1</span><br><span class="line">Date: Sun, 27 Aug 2017 14:59:30 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 274</span><br><span class="line">Last-Modified: Sat, 26 Aug 2017 14:05:36 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">ETag: &quot;59a18030-112&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>

<h3 id="Stop-Nginx"><a href="#Stop-Nginx" class="headerlink" title="Stop Nginx"></a>Stop Nginx</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brew services stop nginx</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®-Configure-2"><a href="#é…ç½®-Configure-2" class="headerlink" title="é…ç½®  Configure"></a>é…ç½®  Configure</h3><h4 id="å»ºç«‹ç›®éŒ„-Create-directories"><a href="#å»ºç«‹ç›®éŒ„-Create-directories" class="headerlink" title="å»ºç«‹ç›®éŒ„  Create directories"></a>å»ºç«‹ç›®éŒ„  Create directories</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /usr/local/etc/nginx/sites-available &amp;&amp; \</span><br><span class="line">$ mkdir -p /usr/local/etc/nginx/sites-enabled &amp;&amp; \</span><br><span class="line">$ mkdir -p /usr/local/etc/nginx/conf.d &amp;&amp; \</span><br><span class="line">$ mkdir -p /usr/local/etc/nginx/ssl</span><br></pre></td></tr></table></figure>

<h4 id="é…ç½®æª”æ¡ˆ-nginx-conf"><a href="#é…ç½®æª”æ¡ˆ-nginx-conf" class="headerlink" title="é…ç½®æª”æ¡ˆ nginx.conf"></a>é…ç½®æª”æ¡ˆ nginx.conf</h4><p>åˆªé™¤é è¨­æª”æ¡ˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rm /usr/local/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<p>å»ºç«‹æ–°æª” <code>$ vim /usr/local/etc/nginx/nginx.conf</code> å…§å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include             mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    #sendfile            on;</span><br><span class="line">    sendfile            off;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout   65;</span><br><span class="line">    keepalive_timeout   1;</span><br><span class="line"></span><br><span class="line">    index index.html index.php;</span><br><span class="line"></span><br><span class="line">    include /usr/local/etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å•Ÿå‹•ä¸¦æ¸¬è©¦-Nginx-Start-and-Test-Nginx"><a href="#å•Ÿå‹•ä¸¦æ¸¬è©¦-Nginx-Start-and-Test-Nginx" class="headerlink" title="å•Ÿå‹•ä¸¦æ¸¬è©¦ Nginx  Start and Test Nginx"></a>å•Ÿå‹•ä¸¦æ¸¬è©¦ Nginx  Start and Test Nginx</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## Start Nginx</span><br><span class="line">$ sudo brew services start nginx</span><br><span class="line"></span><br><span class="line">## Check if Nginx is running on default port</span><br><span class="line">$ curl -IL http://localhost</span><br><span class="line">curl -IL http://localhost</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.12.1</span><br><span class="line">Date: Sun, 27 Aug 2017 15:12:35 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 274</span><br><span class="line">Last-Modified: Sat, 26 Aug 2017 14:05:36 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">ETag: &quot;59a18030-112&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>



<h2 id="è¨­å®š-SSL-Setup-SSL"><a href="#è¨­å®š-SSL-Setup-SSL" class="headerlink" title="è¨­å®š SSL  Setup SSL"></a>è¨­å®š SSL  Setup SSL</h2><p>Generate 4096 bit RSA keys and the self-sign the certificates</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl req -new -newkey rsa:4096 -days 365 -nodes -x509 -subj &quot;/C=US/ST=State/L=Town/O=Office/CN=localhost&quot; -keyout /usr/local/etc/nginx/ssl/localhost.key -out /usr/local/etc/nginx/ssl/localhost.crt</span><br></pre></td></tr></table></figure>
<p>RSA keys å­˜æ”¾åœ¨è³‡æ–™å¤¾ <code>/usr/local/etc/nginx/ssl</code></p>
<h2 id="å»ºç«‹-Virtual-Hosts-ç¶²ç«™æª”æ¡ˆ"><a href="#å»ºç«‹-Virtual-Hosts-ç¶²ç«™æª”æ¡ˆ" class="headerlink" title="å»ºç«‹ Virtual Hosts ç¶²ç«™æª”æ¡ˆ"></a>å»ºç«‹ Virtual Hosts ç¶²ç«™æª”æ¡ˆ</h2><p>æª”æ¡ˆ <code>/usr/local/etc/nginx/sites-available/default</code> å…§å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root       /YOUR/DOCUMENT/ROOT;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/default.access.log  main;</span><br><span class="line">    error_log  /var/log/nginx/default.error.log  debug;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        include   /usr/local/etc/nginx/conf.d/php-fpm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /info &#123;</span><br><span class="line">        allow   127.0.0.1;</span><br><span class="line">        deny    all;</span><br><span class="line">        rewrite (.*) /.info.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page  404     /404.html;</span><br><span class="line">    error_page  403     /403.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æª”æ¡ˆ <code>/usr/local/etc/nginx/sites-available/default-ssl</code> å…§å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       443;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root       /YOUR/DOCUMENT/ROOT;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/default-ssl.access.log  main;</span><br><span class="line">    error_log  /var/log/nginx/default-ssl.error.log  debug;</span><br><span class="line"></span><br><span class="line">    ssl                  on;</span><br><span class="line">    ssl_certificate      ssl/localhost.crt;</span><br><span class="line">    ssl_certificate_key  ssl/localhost.key;</span><br><span class="line"></span><br><span class="line">    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    ssl_protocols  SSLv2 SSLv3 TLSv1;</span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    ssl_prefer_server_ciphers   on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        include   /usr/local/etc/nginx/conf.d/php-fpm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location = /info &#123;</span><br><span class="line">        allow   127.0.0.1;</span><br><span class="line">        deny    all;</span><br><span class="line">        rewrite (.*) /.info.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page  404     /404.html;</span><br><span class="line">    error_page  403     /403.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æª”æ¡ˆ <code>/usr/local/etc/nginx/conf.d/php-fpm</code> å…§å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    try_files      $uri = 404;</span><br><span class="line">    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">    include        fastcgi_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Activate-Virtual-Hosts"><a href="#Activate-Virtual-Hosts" class="headerlink" title="Activate Virtual Hosts"></a>Activate Virtual Hosts</h3><p>åœ¨ <code>sites-enabled</code> ç›®éŒ„ä¸‹å»ºç«‹ Symbolic linkã€‚å°‡è¦ enable çš„ virtal host æŒ‡å‘ <code>sites-available</code> ç›®éŒ„å…§çš„ virtal host config fileã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ln -sfv /usr/local/etc/nginx/sites-available/default /usr/local/etc/nginx/sites-enabled/default</span><br><span class="line">$ ln -sfv /usr/local/etc/nginx/sites-available/default-ssl /usr/local/etc/nginx/sites-enabled/default-ssl</span><br></pre></td></tr></table></figure>

<h3 id="æ¸¬è©¦-Testing-2"><a href="#æ¸¬è©¦-Testing-2" class="headerlink" title="æ¸¬è©¦ Testing"></a>æ¸¬è©¦ Testing</h3><p>å»ºç«‹ <code>/YOUR/DOCUMENT/ROOT/info.php</code> å…§å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>é‡æ–°å•Ÿå‹• Nginx ä¸¦æ¸¬è©¦</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo brew services restart nginx</span><br><span class="line"></span><br><span class="line">$ curl -IL http://localhost/info.php</span><br><span class="line">curl -IL http://localhost/info.php</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.12.1</span><br><span class="line">Date: Sun, 27 Aug 2017 15:24:46 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Connection: keep-alive</span><br><span class="line">X-Powered-By: PHP/7.1.8</span><br></pre></td></tr></table></figure>


<h2 id="å®‰è£å…¶ä»–-Libraries"><a href="#å®‰è£å…¶ä»–-Libraries" class="headerlink" title="å®‰è£å…¶ä»– Libraries"></a>å®‰è£å…¶ä»– Libraries</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install php71-mcrypt php71-imagick</span><br></pre></td></tr></table></figure>

<p><code>brew info</code> æŸ¥çœ‹ PHP åŠå…¶ç›¸é—œ Libraries çš„è³‡è¨Š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">$ brew info php71</span><br><span class="line">homebrew/php/php71: stable 7.1.8 (bottled), HEAD</span><br><span class="line">PHP Version 7.1</span><br><span class="line">https://php.net</span><br><span class="line">Conflicts with:</span><br><span class="line">  php53 (because different php versions install the same binaries.)</span><br><span class="line">  php54 (because different php versions install the same binaries.)</span><br><span class="line">  php55 (because different php versions install the same binaries.)</span><br><span class="line">  php56 (because different php versions install the same binaries.)</span><br><span class="line">  php70 (because different php versions install the same binaries.)</span><br><span class="line">  php72 (because different php versions install the same binaries.)</span><br><span class="line">/usr/local/Cellar/php71/7.1.8_20 (349 files, 39.5MB) *</span><br><span class="line">  Poured from bottle on 2017-08-26 at 16:34:27</span><br><span class="line">From: https://github.com/Homebrew/homebrew-php/blob/master/Formula/php71.rb</span><br><span class="line">==&gt; Dependencies</span><br><span class="line">Required: freetype âœ”, gettext âœ”, icu4c âœ”, jpeg âœ”, libpng âœ”, libxml2 âœ”, unixodbc âœ”, readline âœ”, openssl âœ”</span><br><span class="line">Optional: enchant âœ˜, gmp âœ˜, webp âœ˜, homebrew/apache/httpd24 âœ”, homebrew/apache/httpd22 âœ˜</span><br><span class="line">==&gt; Requirements</span><br><span class="line">Optional: postgresql âœ˜</span><br><span class="line">==&gt; Options</span><br><span class="line">--with-cgi</span><br><span class="line">	Enable building of the CGI executable (implies --without-fpm)</span><br><span class="line">--with-debug</span><br><span class="line">	Compile with debugging symbols</span><br><span class="line">--with-enchant</span><br><span class="line">	Build with enchant support</span><br><span class="line">--with-gmp</span><br><span class="line">	Build with gmp support</span><br><span class="line">--with-homebrew-curl</span><br><span class="line">	Include Curl support via Homebrew</span><br><span class="line">--with-homebrew-libressl</span><br><span class="line">	Include LibreSSL instead of OpenSSL via Homebrew</span><br><span class="line">--with-homebrew-libxml2</span><br><span class="line">	Include Libxml2 support via Homebrew</span><br><span class="line">--with-homebrew-libxslt</span><br><span class="line">	Include LibXSLT support via Homebrew</span><br><span class="line">--with-httpd22</span><br><span class="line">	Enable building of shared Apache 2.2 Handler module</span><br><span class="line">--with-httpd24</span><br><span class="line">	Enable building of shared Apache 2.4 Handler module</span><br><span class="line">--with-imap</span><br><span class="line">	Include IMAP extension</span><br><span class="line">--with-libmysql</span><br><span class="line">	Include (old-style) libmysql support instead of mysqlnd</span><br><span class="line">--with-mssql</span><br><span class="line">	Include MSSQL-DB support</span><br><span class="line">--with-pdo-oci</span><br><span class="line">	Include Oracle databases (requries ORACLE_HOME be set)</span><br><span class="line">--with-pear</span><br><span class="line">	Build with PEAR</span><br><span class="line">--with-phpdbg</span><br><span class="line">	Enable building of the phpdbg SAPI executable</span><br><span class="line">--with-postgresql</span><br><span class="line">	Build with postgresql support</span><br><span class="line">--with-thread-safety</span><br><span class="line">	Build with thread safety</span><br><span class="line">--with-webp</span><br><span class="line">	Build with webp support</span><br><span class="line">--without-bz2</span><br><span class="line">	Build without bz2 support</span><br><span class="line">--without-fpm</span><br><span class="line">	Disable building of the fpm SAPI executable</span><br><span class="line">--without-ldap</span><br><span class="line">	Build without LDAP support</span><br><span class="line">--without-legacy-mysql</span><br><span class="line">	Do not include the deprecated mysql_ functions</span><br><span class="line">--without-mysql</span><br><span class="line">	Remove MySQL/MariaDB support</span><br><span class="line">--without-pcntl</span><br><span class="line">	Build without Process Control support</span><br><span class="line">--without-unixodbc</span><br><span class="line">	Build without unixODBC support</span><br><span class="line">--HEAD</span><br><span class="line">	Install HEAD version</span><br><span class="line">==&gt; Caveats</span><br><span class="line">The php.ini file can be found in:</span><br><span class="line">    /usr/local/etc/php/7.1/php.ini</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© Extensions âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">If you are having issues with custom extension compiling, ensure that you are using the brew version, by placing /usr/local/bin before /usr/sbin in your PATH:</span><br><span class="line"></span><br><span class="line">      PATH=&quot;/usr/local/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">PHP71 Extensions will always be compiled against this PHP. Please install them using --without-homebrew-php to enable compiling against system PHP.</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© PHP CLI âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">If you wish to swap the PHP you use on the command line, you should add the following to ~/.bashrc, ~/.zshrc, ~/.profile or your shell&#x27;s equivalent configuration file:</span><br><span class="line">  export PATH=&quot;$(brew --prefix homebrew/php/php71)/bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">âœ©âœ©âœ©âœ© FPM âœ©âœ©âœ©âœ©</span><br><span class="line"></span><br><span class="line">To launch php-fpm on startup:</span><br><span class="line">    mkdir -p ~/Library/LaunchAgents</span><br><span class="line">    cp /usr/local/opt/php71/homebrew.mxcl.php71.plist ~/Library/LaunchAgents/</span><br><span class="line">    launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.php71.plist</span><br><span class="line"></span><br><span class="line">The control script is located at /usr/local/opt/php71/sbin/php71-fpm</span><br><span class="line"></span><br><span class="line">OS X 10.8 and newer come with php-fpm pre-installed, to ensure you are using the brew version you need to make sure /usr/local/sbin is before /usr/sbin in your PATH:</span><br><span class="line"></span><br><span class="line">  PATH=&quot;/usr/local/sbin:$PATH&quot;</span><br><span class="line"></span><br><span class="line">You may also need to edit the plist to use the correct &quot;UserName&quot;.</span><br><span class="line"></span><br><span class="line">Please note that the plist was called &#x27;homebrew-php.josegonzalez.php71.plist&#x27; in old versions of this formula.</span><br><span class="line"></span><br><span class="line">With the release of macOS Sierra the Apache module is now not built by default. If you want to build it on your system you have to install php with the --with-httpd24 option. See  brew options php71 for more details.</span><br><span class="line"></span><br><span class="line">To have launchd start homebrew/php/php71 now and restart at login:</span><br><span class="line">  brew services start homebrew/php/php71</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å¾Œè¨˜-Epilogue"><a href="#å¾Œè¨˜-Epilogue" class="headerlink" title="å¾Œè¨˜ Epilogue"></a>å¾Œè¨˜ Epilogue</h2><p>å¦‚æœ <code>$ curl -IL http://127.0.0.1:8080</code> å‡ºç¾ <code>curl: (7) Failed to connect to 127.0.0.1 port 8080: Connection refused</code>ï¼Œè«‹è¨˜å¾—æª¢æŸ¥</p>
<ol>
<li>php-fpm æ˜¯ä¸æ˜¯å•Ÿå‹•</li>
<li>nginx æ˜¯å¦æœ‰ restart</li>
<li><code>/usr/loca/etc/php/7.1/php-fpm.d/www.conf</code> å…§ <code>user</code> åŠ <code>group</code> æ˜¯å¦æ­£ç¢ºè¨­å®š</li>
<li><code>/usr/local/etc/nginx/conf.d/php-fpm</code> æª”æ¡ˆæ˜¯å¦å»ºç«‹</li>
</ol>
<hr>
<h2 id="åƒè€ƒè³‡æ–™-References"><a href="#åƒè€ƒè³‡æ–™-References" class="headerlink" title="åƒè€ƒè³‡æ–™  References"></a>åƒè€ƒè³‡æ–™  References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/dtomasi/ab76d14338db82ec24a1fc137caff75b">Install NGINX with PHP7-FPM on Mac OS X with Homebrew</a></li>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/pixeline/51c43c787f51b018d484597f30be3d2b">pixeline&#x2F;php_upgrade_to_71.sh</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/nginx/" rel="tag"># nginx</a>
              <a href="/tags/php71/" rel="tag"># php71</a>
              <a href="/tags/php-fpm/" rel="tag"># php-fpm</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/2017081804-wget-download-web-pages.html" rel="prev" title="ä½¿ç”¨ wget ç ç«™">
                  <i class="fa fa-chevron-left"></i> ä½¿ç”¨ wget ç ç«™
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2017/2017082901-editorconfig-settings.html" rel="next" title="ä½¿ç”¨ EditorConfig çµ±ä¸€å°ˆæ¡ˆçš„ Coding Style">
                  ä½¿ç”¨ EditorConfig çµ±ä¸€å°ˆæ¡ˆçš„ Coding Style <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 â€“ 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jerry Huang</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">NaNm</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">NaN:aN</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
